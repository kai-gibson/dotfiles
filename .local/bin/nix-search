#!/usr/bin/env python3

# A simple python program to search through nixpkgs

import sys
from numpy import sort
import pandas as pd
from fuzzywuzzy import fuzz

data = pd.read_csv("~/.cache/nix_pkgs.csv")


def find_pkg(search_term, order='reverse'):

    closeness = []
    
    for i in data['pkg_name'].values:
        closeness.append(fuzz.token_sort_ratio(i, search_term))

    data['closeness'] = closeness
    sorted_df = data.sort_values(by='closeness', ascending=False)
    
    # Print "pkg_full_name version\ndescription"
    pkg_full_name = sorted_df['pkg_full_name'].to_list()
    version = sorted_df['version'].to_list()
    description = sorted_df['description'].to_list()

    if order == 'reverse':
        for i in range(19, -1, -1):
            print(i+1, pkg_full_name[i], version[i])
            if i == 0:
                print(description[i])
            else:
                print(description[i], '\n')
    else:
        for i in range(0, 20):
            print(i+1, pkg_full_name[i], version[i])
            if i == 19:
                print(description[i])
            else:
                print(description[i], '\n')
            


find_pkg(sys.argv[1])
